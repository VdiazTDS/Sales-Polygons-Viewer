<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <title>TDS-PAK Sales Polygons Viewer</title>

  <!-- Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet" />

  <!-- Leaflet CSS -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />

  <!-- App CSS -->
  <link rel="stylesheet" href="style.css" />

  <link rel="icon" href="favicon.ico" />
</head>

<body>
  <!-- ================= HEADER ================= -->
  <header>
    <h1>TDS-PAK Sales Polygons Viewer</h1>
    <p>Upload, manage, and visualize TDS-PAK sales polygon GeoJSON layers</p>
    <button id="mobileMenuBtn">‚ò∞ Menu</button>
  </header>

  <!-- ================= MAIN LAYOUT ================= -->
  <div class="app-container">

    <!-- Desktop sidebar collapse toggle -->
    <button id="toggleSidebarBtn" class="sidebar-toggle">‚ùÆ</button>

    <!-- ================= SIDEBAR ================= -->
    <aside class="sidebar">

      <!-- Upload -->
      <div id="dropZone">üìÇ Drag & drop GeoJSON or click to upload</div>

      <!-- Saved GeoJSON Layers -->
      <div class="filter-group">
        <strong>GeoJSON Layers</strong>
        <ul id="savedFiles"></ul>
      </div>

      <!-- Collapsible Help Panel -->
      <div class="filter-group help-panel">
        <button id="helpToggle" class="help-toggle">‚ùì Click for Help & Instructions</button>

        <div id="helpContent" class="help-content">
  <ul>
    <li><strong>Upload a file:</strong> Drag and drop a GeoJSON file into the upload box, or click the box to choose a file from your computer.</li>
    <li><strong>Open a saved layer:</strong> Click the <b>Open</b> button next to any file name to show it on the map.</li>
    <li><strong>Change a layer‚Äôs color:</strong> In the legend below the map style menu, click the small colored square next to a layer name and choose a new color.</li>
    <li><strong>Reset the map:</strong> Click <b>Reset Map View</b> to zoom out to the full world, remove all layers from the map, and clear the legend.</li>
    <li><strong>Delete a file:</strong> Click the <b>Delete</b> button next to a file name to permanently remove it from the site.</li>
  </ul>
</div>
      </div>

      <!-- Reset Map -->
      <button id="resetMapBtn">Reset Map View</button>

      <!-- Basemap Selector -->
      <select id="baseMapSelect">
        <option value="streets">Streets</option>
        <option value="satellite">Satellite</option>
      </select>

      <!-- ================= LEGEND ================= -->
      <div id="mapLegend" class="map-legend" style="display:none; margin-top:10px;">
        <strong>Visible Layers</strong>
        <ul id="legendList"></ul>
      </div>

    </aside>

    <!-- ================= MAP ================= -->
    <main class="map-container">
      <div id="map"></div>

      <!-- ================= MAP LEGEND ================= -->
      <div id="mapLegend" class="map-legend" style="display:none;">
        <strong>Visible Layers</strong>
        <ul id="legendList"></ul>
      </div>
    </main>

  </div>

  <!-- ================= SCRIPTS ================= -->
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

  <!-- App JS -->
  <script src="app.js"></script>
  <script>
    // =============================================================
    // COLLAPSIBLE HELP PANEL TOGGLE
    // Adds expand/collapse behavior for Help section
    // =============================================================
    const helpToggle = document.getElementById("helpToggle");
    const helpContent = document.getElementById("helpContent");

    if (helpToggle && helpContent) {
      helpToggle.addEventListener("click", () => {
        const isOpen = helpContent.classList.toggle("open");
        helpToggle.textContent = isOpen ? "‚ñº Click for Help & Instructions" : "‚ñ∂ Click for Help & Instructions";
      });
    }
  </script>
</body>
</html>
